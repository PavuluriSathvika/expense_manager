<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background: radial-gradient(circle at 30% 30%, rgba(72, 0, 255, 0.25), transparent 70%),
                  radial-gradient(circle at 70% 70%, rgba(0, 255, 255, 0.15), transparent 70%),
                  linear-gradient(135deg, #0a0f29, #050b1f);
      color: white;
      overflow-x: hidden;
      position: relative;
    }

    .blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.5;
      animation: float 20s infinite ease-in-out alternate;
    }

    .blob:nth-child(1) {
      top: 10%;
      left: 10%;
      width: 300px;
      height: 300px;
      background: #6a00ff;
    }

    .blob:nth-child(2) {
      bottom: 15%;
      right: 10%;
      width: 350px;
      height: 350px;
      background: #00fff0;
      animation-delay: 4s;
    }

    @keyframes float {
      0% { transform: translate(0, 0) scale(1); }
      100% { transform: translate(30px, -50px) scale(1.2); }
    }

    .navbar {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(12px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
      transition: all 0.4s ease;
    }

    .navbar-brand {
      font-weight: 700;
      color: #00eaff !important;
      letter-spacing: 0.5px;
    }

    .nav-link {
      color: white !important;
      margin-right: 20px;
      position: relative;
      font-weight: 500;
    }

    .nav-link::after {
      content: "";
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0%;
      height: 2px;
      background: #00eaff;
      transition: 0.3s;
    }

    .nav-link:hover::after {
      width: 100%;
    }
    <!-- ðŸŒ— Dark/Light Mode Toggle -->
<div id="themeToggle" class="theme-toggle" onclick="toggleTheme()">
  ðŸŒ™
</div>


  .theme-toggle {
    position: fixed;
    top: 90px;
    right: 30px;
    background: rgba(255, 255, 255, 0.15);
    border-radius: 50%;
    width: 50px;
    height: 50px;
    color: white;
    font-size: 1.4rem;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 1000;
    transition: all 0.5s ease;
    box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
  }

  .theme-toggle:hover {
    transform: scale(1.1) rotate(10deg);
    box-shadow: 0 0 25px rgba(0, 255, 255, 0.5);
  }

  /* ðŸŒž Light Theme Styles */
  /* ðŸŒž LIGHT THEME FIX */
body.light-mode {
  background: linear-gradient(135deg, #ffffff, #e9f0ff);
  color: #1a1a1a;
}

body.light-mode h2 {
  background: linear-gradient(90deg, #6a00ff, #00eaff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  text-shadow: none;
}

body.light-mode .navbar {
  background: rgba(255, 255, 255, 0.85);
  border-bottom: 1px solid rgba(0, 0, 0, 0.1);
}

body.light-mode .nav-link {
  color: #1a1a1a !important;
}

body.light-mode .card-glass {
  background: rgba(255, 255, 255, 0.9);
  color: #1a1a1a;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
}

body.light-mode .btn-gradient {
  background: linear-gradient(90deg, #00b4ff, #6a00ff);
  color: white;
}

body.light-mode .progress-bar {
  background: #6a00ff;
}

body.light-mode .blob {
  opacity: 0.1;
}

body.light-mode canvas {
  background: white;
  border-radius: 20px;
  padding: 10px;
}
/* ðŸŽ¯ Fix Smart Financial Insights text for light mode */
/* âœ¨ Smart Financial Insights styling */

/* Light Mode */
/* Light mode blobs */
body.light-mode .blob {
  opacity: 0.05;
}

/* Card Glass for light mode */
body.light-mode .card-glass {
  background: linear-gradient(135deg, #ffffff, #f0f4ff);
  color: #1a1a1a;
  box-shadow: 0 8px 25px rgba(100, 100, 255, 0.15);
  transition: all 0.5s ease;
}

/* Card hover effect */
body.light-mode .card-glass:hover {
  transform: translateY(-10px) scale(1.05);
  box-shadow: 0 12px 30px rgba(100, 100, 255, 0.25);
}

/* Gradient Buttons with hover animation */
body.light-mode .btn-gradient {
  background: linear-gradient(135deg, #00b4ff, #6a00ff);
  color: white;
  transition: all 0.3s ease;
}

body.light-mode .btn-gradient:hover {
  transform: scale(1.1);
  box-shadow: 0 0 20px rgba(122, 0, 255, 0.4);
}

/* Insight Cards */
body.light-mode .insight-card {
  background: linear-gradient(135deg, #ffffff, #f3f4ff, #fef6ff);
  color: #1a1a1a;
  box-shadow: 0 4px 25px rgba(100, 100, 255, 0.15);
  border-left: 6px solid #7a00ff;
  border-radius: 20px;
  backdrop-filter: blur(6px);
  animation: glowPulse 3s infinite ease-in-out;
}

/* Soft glow animation */
@keyframes glowPulse {
  0% { box-shadow: 0 0 15px rgba(122, 0, 255, 0.1); }
  50% { box-shadow: 0 0 25px rgba(122, 0, 255, 0.25); }
  100% { box-shadow: 0 0 15px rgba(122, 0, 255, 0.1); }
}






    .dashboard-container {
      padding: 120px 20px;
      max-width: 1200px;
      margin: auto;
      position: relative;
      z-index: 2;
    }

    h2 {
      text-align: center;
      font-weight: 700;
      margin-bottom: 50px;
      background: linear-gradient(90deg, #00eaff, #9a00ff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: glow 3s infinite alternate;
    }

    @keyframes glow {
      from { text-shadow: 0 0 10px #00eaff; }
      to { text-shadow: 0 0 20px #9a00ff; }
    }

    .card-glass {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      border-radius: 20px;
      padding: 25px;
      color: white;
      text-align: center;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.05);
      transition: all 0.4s ease;
      animation: fadeUp 0.8s ease forwards;
    }

    .card-glass:hover {
      transform: translateY(-10px) scale(1.03);
      box-shadow: 0 0 25px rgba(0, 255, 255, 0.2);
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .btn-gradient {
      background: linear-gradient(90deg, #00eaff, #6a00ff);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 18px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-gradient:hover {
      transform: scale(1.05);
      box-shadow: 0 0 15px #00eaff;
    }

    .insights-section {
      margin-top: 80px;
      text-align: center;
    }

    .insight-card {
      background: rgba(255, 255, 255, 0.08);
      backdrop-filter: blur(15px);
      border-radius: 15px;
      padding: 25px;
      max-width: 700px;
      margin: 0 auto;
      color: white;
      font-size: 1.1rem;
      line-height: 1.8;
      box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
    }

    .typewriter {
      display: inline-block;
      border-right: 3px solid #00eaff;
      white-space: nowrap;
      overflow: hidden;
      animation: typing 3s steps(30, end), blink 0.7s infinite;
    }

    @keyframes typing {
      from { width: 0 }
      to { width: 100% }
    }

    @keyframes blink {
      50% { border-color: transparent }
    }

  </style>
</head>

<body class="{{ theme or 'dark' }}">
  <div class="blob"></div>
  <div class="blob"></div>

  <nav class="navbar navbar-expand-lg fixed-top px-4">
    <a class="navbar-brand" href="{{ url_for('dashboard') }}">Expense Manager</a>
    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto align-items-center">
        <li class="nav-item"><a class="nav-link" href="{{ url_for('dashboard') }}">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('add_expense') }}">Add Expense</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('view_expenses') }}">View Expenses</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('search_expenses') }}">Search</a></li>
        <li class="nav-item"><a class="nav-link" href="{{ url_for('monthly_salary') }}">Salary</a></li>
        <li class="nav-item"><a class="nav-link text-danger" href="{{ url_for('logout') }}">Logout</a></li>
      </ul>
    </div>
  </nav>

  <!-- ðŸŒ— Theme Toggle Button -->
  <button id="themeToggle" 
    class="position-fixed rounded-circle" 
    style="top: 100px; right: 30px; z-index: 9999; background: linear-gradient(135deg, #00eaff, #9a00ff); color: white; border: none; padding: 12px 16px; font-size: 18px; box-shadow: 0 0 15px rgba(0, 234, 255, 0.6); cursor: pointer;">
    {% if theme == 'light' %}ðŸŒž{% else %}ðŸŒ™{% endif %}
  </button>

  <div class="dashboard-container text-center">
    <h2>Dashboard</h2>
    <!-- Metric Cards -->
    <div class="row g-4 justify-content-center">
      <div class="col-md-3 card-glass">
        <h5>Total Expenses</h5>
        <h3>â‚¹{{ total_spent }}</h3>
      </div>

      <div class="col-md-3 card-glass">
        <h5>Monthly Salary</h5>
        <h3>â‚¹{{ monthly_salary }}</h3>
        <a href="{{ url_for('monthly_salary') }}" class="btn-gradient mt-3">Update</a>
      </div>

      <div class="col-md-3 card-glass">
        <h5>Balance Remaining</h5>
        <h3>â‚¹{{ remaining }}</h3>
      </div>

      <div class="col-md-3 card-glass">
        <h5>Total Savings</h5>
        <h3>â‚¹{{ total_saved }}</h3>
        <a href="{{ url_for('view_savings') }}" class="btn-gradient mt-3">View Savings</a>
      </div>
    </div>

    <!-- Expense Distribution Chart -->
    <div class="container mt-5">
      <h3 class="text-center mb-4" style="background: linear-gradient(90deg, #00eaff, #9a00ff);
        -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
        Expense Distribution by Category
      </h3>

      <div class="card-glass p-4 mx-auto" style="max-width: 700px;">
        <canvas id="expenseChart" height="250"></canvas>
      </div>
    </div>

    <!-- Smart Financial Insights -->
    <div class="insights-section">
      <h3>ðŸ’¡ Smart Financial Insights</h3>
      <div class="insight-card mt-4">
        {% for tip in insights %}
          <p class="typewriter">{{ tip }}</p><br>
        {% endfor %}
      </div>
    </div>
  </div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const ctx = document.getElementById('expenseChart');
  new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: {{ categories | default([]) | tojson }},
      datasets: [{
        label: 'Expenses by Category',
        data: {{ category_amounts | default([]) | tojson }},
        backgroundColor: [
          '#00eaff', '#9a00ff', '#36A2EB', '#FF6384', '#FFCE56',
          '#4BC0C0', '#9966FF', '#FF9F40'
        ],
        borderColor: '#0a0f29',
        borderWidth: 2,
        hoverOffset: 15
      }]
    },
    options: {
      plugins: {
        legend: {
          labels: {
            color: document.body.classList.contains('light-mode') ? '#000' : 'white',
            font: { size: 14 }
          },
          position: 'bottom'
        }
      }
    }
  });

  // Theme toggle
  const toggleBtn = document.getElementById('themeToggle');
  toggleBtn.addEventListener('click', () => {
    const isLight = document.body.classList.toggle('light-mode');
    toggleBtn.textContent = isLight ? 'ðŸŒž' : 'ðŸŒ™';

    // Call Flask route to save theme in session
    fetch(`/set_theme/${isLight ? 'light' : 'dark'}`)
      .then(() => console.log('Theme updated on server'));
  });
</script>
<!-- SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    {% if show_popup %}
    Swal.fire({
        icon: 'warning',
        title: 'Budget Exceeded!',
        text: 'Your expenses are more than your salary.',
        confirmButtonColor: '#d33'
    });
    {% endif %}
</script>

</body>

</html>
